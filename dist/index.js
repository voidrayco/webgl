!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three"),require("ramda"),require("d3-color"),require("react"),require("bowser")):"function"==typeof define&&define.amd?define(["three","ramda","d3-color","react","bowser"],e):"object"==typeof exports?exports.voidgl=e(require("three"),require("ramda"),require("d3-color"),require("react"),require("bowser")):t.voidgl=e(t.three,t.ramda,t["d3-color"],t.react,t.bowser)}(this,function(t,e,n,i,o){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=20)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n,i){this.height=0,this.width=0,this.x=0,this.y=0,4===arguments.length&&(this.x=t,this.width=e-t,this.y=n,this.height=n-i)}return Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y-this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mid",{get:function(){return{x:this.x+this.width/2,y:this.y-this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),t.prototype.containsPoint=function(t){return!(t.x<this.x)&&(!(t.y>this.y)&&(!(t.x>this.right)&&!(t.y<this.bottom)))},t.prototype.copyBounds=function(t){this.height=t.height,this.width=t.width,this.x=t.x,this.y=t.y},t.prototype.encapsulate=function(t){t.x<this.x&&(this.width+=this.x-t.x,this.x=t.x),t.y>this.y&&(this.height+=t.y-this.y,this.y=t.y),t.right>this.right&&(this.width=t.right-this.x),t.bottom<this.bottom&&(this.height=this.y-t.bottom)},t.prototype.encapsulateBounds=function(e,n){if(n&&e.length&&this.copyBounds(e[0]),0!==e.length){var i=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=-Number.MAX_VALUE;e.forEach(function(t){t.x<i?i=t.x:t.right>o&&(o=t.right),t.bottom<r?r=t.bottom:t.y>s&&(s=t.y)}),this.encapsulate(new t(i,o,s,r))}},t.prototype.encapsulatePoint=function(t){t.x<this.x&&(this.width+=this.x-t.x,this.x=t.x),t.y>this.y&&(this.height+=t.y-this.y,this.y=t.y),t.x>this.right&&(this.width=t.x-this.x),t.y<this.bottom&&(this.height=this.y-t.y)},t.prototype.encapsulatePoints=function(e){var n=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,r=-Number.MAX_VALUE;void 0!==e[0]&&e[0].x?e.forEach(function(t){t.x<n?n=t.x:t.x>i&&(i=t.x),t.y<o?o=t.y:t.y>r&&(r=t.y)}):e.forEach(function(t){t[0]<n?n=t[0]:t[0]>i&&(i=t[0]),t[1]<o?o=t[1]:t[1]>r&&(r=t[1])}),this.encapsulate(new t(n,i,r,o))},t.prototype.fits=function(t){return this.width===t.width&&this.height===t.height?1:this.width>=t.width&&this.height>=t.height?2:0},t.prototype.hitBounds=function(t){return!(t.right<this.x)&&(!(t.x>this.right)&&(!(t.bottom>this.y)&&!(t.y<this.bottom)))},t.prototype.pointInside=function(t){return!(t.x<this.x)&&(!(t.y>this.y)&&(!(t.x>this.right)&&!(t.y<this.bottom)))},t.isBounds=function(t){return!!t&&(t instanceof this||t&&"containsPoint"in t&&"encapsulate"in t&&"hitTest"in t)},t.prototype.isInside=function(t){return t.x<=this.x&&t.right>=this.right&&t.y>=this.y&&t.bottom<=this.bottom},t.maxBounds=function(){return new t(Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE)},t}();e.Bounds=i},function(e,n){e.exports=t},function(t,e,n){(function(i){function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function r(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var o=0,r=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(r=o))}),t.splice(r,0,i)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}}function u(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t}e=t.exports=n(24),e.log=s,e.formatArgs=r,e.save=a,e.load=u,e.useColors=o,e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(u())}).call(e,n(23))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){},t.prototype.update=function(t){return!1},t}();e.BaseBuffer=i},function(t,e,n){"use strict";function i(t,e){M=t[0],P=t[1],C=t[2],T=t[3],S=t[4],O=t[5],B=t[6],D=e[0],U=e[1],X=e[2],N=e[3],W=e[4],k=e[5],Y=e[6]}function o(t,e){for(var n=q;n<t;++n)A=n*D,e(n-q,M,A)}function r(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,e(n-q,M,A,P,L)}function s(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,z=n*X,e(n-q,M,A,P,L,C,z)}function a(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,z=n*X,I=n*N,e(n-q,M,A,P,L,C,z,T,I)}function u(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,z=n*X,I=n*N,R=n*W,e(n-q,M,A,P,L,C,z,T,I,S,R)}function h(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,z=n*X,I=n*N,R=n*W,E=n*k,e(n-q,M,A,P,L,C,z,T,I,S,R,O,E)}function c(t,e){for(var n=q;n<t;++n)A=n*D,L=n*U,z=n*X,I=n*N,R=n*W,E=n*k,j=n*Y,e(n-q,M,A,P,L,C,z,T,I,S,R,O,E,B,j)}function l(t){v=t[0]||0,x=t[1]||0,w=t[2]||0,_=t[3]||0}function d(t,e){t[e]=v}function f(t,e){t[e]=v,t[++e]=x}function p(t,e){t[e]=v,t[++e]=x,t[++e]=w}function y(t,e){t[e]=v,t[++e]=x,t[++e]=w,t[++e]=_}Object.defineProperty(e,"__esModule",{value:!0});var g,m=n(1),b=n(2)("WebGLSurface:BufferUtil");!function(t){t[t.ONE=0]="ONE",t[t.TWO=1]="TWO",t[t.THREE=2]="THREE",t[t.FOUR=3]="FOUR"}(g=e.AttributeSize||(e.AttributeSize={}));var v=0,x=0,w=0,_=0,M=[],P=[],C=[],T=[],S=[],O=[],B=[],A=0,L=0,z=0,I=0,R=0,E=0,j=0,D=0,U=0,X=0,N=0,W=0,k=0,Y=0,q=0,H=!1,V=(G={},G[g.ONE]=d,G[g.TWO]=f,G[g.THREE]=p,G[g.FOUR]=y,G),Z={1:o,2:r,3:s,4:a,5:u,6:h,7:c},F=function(){function t(){}return t.beginUpdates=function(){H=!0,q=0},t.endUpdates=function(){var t=q;return H=!1,q=0,t},t.makeBuffer=function(t,e){for(var n=e.length,i=new m.BufferGeometry,o=0;o<n;++o){var r=e[o],s=r.size+1,a=new Float32Array(s*t),u=V[r.size],h=r.name;l(r.defaults);for(var c=0;c<t;++c)u(a,c*s);i.addAttribute(h,new m.BufferAttribute(a,s)),b("Made Buffer Attribute:",h,s)}return i},t.updateBuffer=function(t,e,n,o,r){var s=e.attributes,a=e.geometry,u=0!==q&&H;if(void 0!==t&&t!==e.currentData||u){H||(q=0),e.currentData=t;var h=s.map(function(t){return a.attributes[t.name]});i(h.map(function(t){return t.array}),s.map(function(t){return(t.size+1)*n}));return(0,Z[s.length])(o+q,r),h.forEach(function(t){return t.needsUpdate=!0}),q+=o,!0}return q+=o,!1},t.makeBufferItems=function(){return{attributes:[],currentData:[],geometry:null,system:null}},t}();e.BufferUtil=F;var G},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=function(t){function e(e,n){var i=t.call(this,0,1,1,0)||this;return i.setPoints(e,n),i}return i(e,t),e.prototype.directionTo=function(t){var e={x:this.p1.x-t.x,y:this.p1.y-t.y};return this.perpendicular.x*e.x+this.perpendicular.y*e.y},e.prototype.distanceTo=function(t){var e={x:this.p1.x-t.x,y:this.p1.y-t.y};return Math.abs(this.perpendicular.x*e.x+this.perpendicular.y*e.y)},e.getClosest=function(t,e){var n,i=Number.MAX_VALUE,o=0;return t.forEach(function(t){(o=t.distanceTo(e))<i&&(n=t,i=o)}),n},e.prototype.setPoints=function(t,e){this.x=t.x-1,this.y=t.y-1,this.width=2,this.height=2,this.encapsulatePoint(e);var n=e.x-t.x,i=e.y-t.y;this.slope=i/n,this.p1=t,this.p2=e,this.magnitude=Math.sqrt(n*n+i*i),this.perpendicular={x:this.p2.y-this.p1.y,y:-(this.p2.x-this.p1.x)};var o=Math.sqrt(this.perpendicular.x*this.perpendicular.x+this.perpendicular.y*this.perpendicular.y);this.perpendicular.x/=o,this.perpendicular.y/=o},e}(o.Bounds);e.Line=r},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.aspectRatio=1,this.imagePath=t,this.label=e,e&&(this.label.rasterizedLabel=this)}return t}();e.AtlasTexture=i},function(t,e,n){"use strict";function i(t,e){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.add=function(t,e,n){return n?(n.x=t.x+e.x,n.y=t.y+e.y,n):{x:t.x+e.x,y:t.y+e.y}},t.getClosest=function(t,e){var n,o=Number.MAX_VALUE,r=null,s=function(e){(n=i(e,t))<o&&(o=n,r=e)};return e.forEach(s),r},t.getClosestIndex=function(t,e){var n,o=Number.MAX_VALUE,r=0,s=function(e,s){(n=i(e,t))<o&&(o=n,r=s)};return e.forEach(s),r},t.getDirection=function(t,e,n){void 0===n&&(n=!1);var i=e.x-t.x,o=e.y-t.y;if(n){var r=Math.sqrt(i*i+o*o);i/=r,o/=r}return{x:i,y:o}},t.getDistance=function(t,e,n){return void 0===n&&(n=!1),n?i(t,e):Math.sqrt(i(t,e))},t.getMidpoint=function(e,n){var i=t.getDirection(e,n);return{x:i.x/2+e.x,y:i.y/2+e.y}},t.make=function(t,e){return{x:t,y:e}},t.scale=function(t,e,n){return n?(n.x=t.x*e,n.y=t.y*e,n):{x:t.x*e,y:t.y*e}},t.zero=function(){return{x:0,y:0}},t}();e.Point=o},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],r=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0});var r=n(7),s=n(1),a=n(0),u=n(11),h=n(8),c=n(2)("webgl-surface:Atlas"),l=n(2)("webgl-surface:Labels"),d=function(){function t(t,e){this.atlasImages={},this.atlasMap={},this.atlasTexture={},this.textureWidth=t,this.textureHeight=e}return t.prototype.createAtlas=function(t,e,n){return i(this,void 0,void 0,function(){var i,r,a,h,l,l,d,f;return o(this,function(o){switch(o.label){case 0:if(i=new u.PackNode(0,0,this.textureWidth,this.textureHeight),this.atlasMap[t]=i,this.atlasImages[t]=[],r=document.createElement("canvas").getContext("2d"),r.canvas.width=this.textureWidth,r.canvas.height=this.textureHeight,!e)return[3,4];a=0,h=e,o.label=1;case 1:return a<h.length?(l=h[a],[4,this.draw(l,t,r)]):[3,4];case 2:o.sent(),o.label=3;case 3:return a++,[3,1];case 4:return n?[4,this.drawColors(n,t,r)]:[3,6];case 5:l=o.sent(),l&&this.atlasImages[t].push(l),o.label=6;case 6:return d=new s.Texture(r.canvas),d.premultiplyAlpha=!0,d.generateMipmaps=!0,this.atlasTexture[t]=d,e&&(f=this.atlasImages[t]).push.apply(f,e),c("Atlas Created-> texture: %o mapping: %o images: %o",d,i,e),[2,d]}})})},t.prototype.destroyAtlas=function(t){if(this.atlasTexture[t]&&(this.atlasTexture[t].dispose(),this.atlasTexture[t]=null),this.atlasMap[t]&&(this.atlasMap[t].destroy(),this.atlasMap[t]=null),this.atlasImages[t]){var e={x:0,y:0};this.atlasImages[t].forEach(function(t){t.atlasReferenceID=null,t.pixelWidth=0,t.pixelHeight=0,t.atlasBL=e,t.atlasBR=e,t.atlasTL=e,t.atlasTR=e}),this.atlasImages[t]=null}},t.prototype.draw=function(t,e,n){return i(this,void 0,void 0,function(){var i,r,s,u,h,d,f,p,y,g;return o(this,function(o){switch(o.label){case 0:return this.atlasMap[e]?[4,this.loadImage(t)]:(c("Can not load image, invalid Atlas Name: %o for atlasMaps: %o",e,this.atlasMap),[2,!1]);case 1:if(i=o.sent(),t.atlasReferenceID=null,i){if(c("Image loaded: %o",t.imagePath),r=new a.Bounds(0,t.pixelWidth,t.pixelHeight,0),s={first:t,second:r},s.second.width+=1,s.second.height+=1,u=this.atlasMap[e],h=u.insert(s))return c("Atlas location determined: %o",h),t.label&&l("Atlas location determined. PackNode: %o Dimensions: %o",h,s),h.nodeImage=t,d=h.nodeDimensions.x/this.textureWidth,f=h.nodeDimensions.y/this.textureHeight,p=h.nodeDimensions.width/this.textureWidth,y=h.nodeDimensions.height/this.textureHeight,l("uy is %o",f),g=new a.Bounds(d,d+p,1-f,1-(f+y)),t.atlasReferenceID=e,t.atlasBL={x:g.x,y:g.y-g.height},t.atlasBR={x:g.x+g.width,y:g.y-g.height},t.atlasTL={x:g.x,y:g.y},t.atlasTR={x:g.x+g.width,y:g.y},n.drawImage(i,h.nodeDimensions.x,h.nodeDimensions.y),[2,!0];throw new Error("Could not fit image into atlas "+t.imagePath)}throw new Error("Could not load image "+t.imagePath)}})})},t.prototype.drawColors=function(t,e,n){return i(this,void 0,void 0,function(){var i,r,s,u,l,d,f,p,y,g,m,b,v,x,w,_,M,P,C,T,S,O,B,A,L,z,I,R,E,j,D,U;return o(this,function(o){if(c("Finding space for colors on the atlas: %o",t),i=2,r=2,s=512/i,u=Math.min(this.textureWidth,s*i),l=Math.ceil(t.length*i/u),d=Math.ceil(u/i),f=l*r,p={first:new h.AtlasTexture(null,null),second:new a.Bounds(0,u,f,0)},p.second.width+=1,p.second.height+=1,y=this.atlasMap[e],g=y.insert(p)){for(c("Atlas location determined for colors: %o",g),m=g.nodeImage=p.first,b=g.nodeDimensions.x/this.textureWidth,v=g.nodeDimensions.y/this.textureHeight,x=g.nodeDimensions.width/this.textureWidth,w=g.nodeDimensions.height/this.textureHeight,_=new a.Bounds(b,b+x,1-v,1-(v+w)),m.atlasReferenceID=e,m.atlasBL={x:_.x,y:_.y-_.height},m.atlasBR={x:_.x+_.width,y:_.y-_.height},m.atlasTL={x:_.x,y:_.y},m.atlasTR={x:_.x+_.width,y:_.y},M=g.nodeDimensions,P=M.x,C=M.y,T=i/this.textureWidth,S=-r/this.textureHeight,O=P/this.textureWidth+T/2,B=1-C/this.textureHeight+S/2,A=0,L=0,z=0,I=t;z<I.length;z++)R=I[z],R.atlasReferenceID=e,R.colorIndex=A+L*d,R.colorsPerRow=d,R.firstColor={x:O,y:B},R.nextColor={x:T,y:S},E=R.color,j=E.r,D=E.g,U=E.b,n.fillStyle="rgba("+Math.round(255*j)+", "+Math.round(255*D)+", "+Math.round(255*U)+", "+R.opacity+")",n.fillRect(A*i+P,L*r+C,i,r),++A===d&&(A=0,L++);return[2,m]}throw new Error("Could not fit colors into atlas")})})},t.prototype.getAtlasTexture=function(t){return this.atlasTexture[t]},t.prototype.loadImage=function(t){return t.imagePath?new Promise(function(e,n){var i=new Image;i.onload=function(){t.pixelWidth=i.width,t.pixelHeight=i.height,t.aspectRatio=i.width/i.height,e(i)},i.onerror=function(){e(null)},i.src=t.imagePath}):t.label?new Promise(function(e,n){var i=t.label,o=i.getSize(),s=document.createElement("canvas"),a=s.getContext("2d");if(s.width=o.width+t.label.rasterizationPadding.width,s.height=o.height+t.label.rasterizationPadding.height,a){var u=i.fontSize,h=r.rgb(255*i.r,255*i.g,255*i.b,i.a);a.font=i.makeCSSFont(u),a.textAlign=i.textAlign,a.textBaseline=i.textBaseline,a.fillStyle=h.toString(),a.fillText(i.text,t.label.rasterizationOffset.x,t.label.height/2+t.label.rasterizationOffset.y);var c=new Image;c.onload=function(){t.pixelWidth=c.width,t.pixelHeight=c.height,t.aspectRatio=c.width/c.height,l("Applying size based on rasterization to the Label: w: %o h: %o",c.width,c.height),i.setSize({height:c.height,width:c.width}),e(c)},c.onerror=function(){e(null)},c.src=s.toDataURL("image/png")}}):Promise.resolve(null)},t}();e.AtlasManager=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=function(){function t(t,e,n,o){this.child=[null,null],this.isLeaf=!0,this.nodeImage=null,this.nodeDimensions=new i.Bounds(t,t+n,e,e-o)}return t.prototype.destroy=function(){this.nodeImage=null,this.child[0]&&this.child[0].destroy(),this.child[1]&&this.child[1].destroy(),this.child[0]=void 0,this.child[1]=void 0},t.prototype.hasChild=function(){return this.child[0]&&!this.child[0].nodeImage?!this.child[0].isLeaf:!(!this.child[1]||this.child[1].nodeImage)&&!this.child[1].isLeaf},t.prototype.insert=function(e){if(!this.isLeaf){var n=this.child[0].insert(e);return null!==n?n:this.child[1].insert(e)}if(this.nodeImage)return null;var i=this.nodeDimensions.fits(e.second);if(0===i)return null;if(1===i)return this;this.isLeaf=!1;var o=e.second.width,r=e.second.height,s=this.nodeDimensions.width-o,a=this.nodeDimensions.height-e.second.height;return s>a?(this.child[0]=new t(this.nodeDimensions.x,this.nodeDimensions.y,o,this.nodeDimensions.height),this.child[1]=new t(this.nodeDimensions.x+o,this.nodeDimensions.y,s,this.nodeDimensions.height)):(this.child[0]=new t(this.nodeDimensions.x,this.nodeDimensions.y,this.nodeDimensions.width,r),this.child[1]=new t(this.nodeDimensions.x,this.nodeDimensions.y+r,this.nodeDimensions.width,a)),this.child[0].insert(e)},t.prototype.remove=function(t){if(this.isLeaf)return this.nodeImage===t&&(this.nodeImage=null,t.atlasReferenceID=null,t.pixelWidth=0,!0);var e=this.child[0].remove(t);return!!e||(e=this.child[1].remove(t),this.child[0].hasChild()||this.child[1].hasChild()||(this.child[0]=null,this.child[1]=null),e)},t}();e.PackNode=o},function(t,e,n){"use strict";function i(t){var e=t.nativeEvent,n=0,i=0;return Math.sign(y[0])!==Math.sign(i)&&y.splice(0,y.length,0,0,0,0),n=e.deltaX*p,i=e.deltaY*p*g+y[0]*m+y[1]*b+y[2]*v,y.unshift(i),y.pop(),new c.Vector2(-n,i)}function o(t){var e=t.nativeEvent;return new c.Vector2(e.deltaX,e.deltaY)}function r(t){var e=t.nativeEvent,n=e.deltaX;void 0===n&&(n=void 0!==e.wheelDeltaX?e.wheelDeltaX*d:0);var i=e.deltaY;return void 0===i&&(i=void 0!==e.wheelDeltaY?e.wheelDeltaY*d:(e.wheelDelta||-e.detail)*f),new c.Vector2(-n,i)}function s(t){var e=t.nativeEvent,n=e.deltaX,i=e.deltaY;void 0===n&&(n=void 0!==e.wheelDeltaX?e.wheelDeltaX*d:0),void 0===i&&(i=void 0!==e.wheelDeltaY?e.wheelDeltaY*d:e.wheelDelta||-e.detail);var o=new c.Vector2(n,i);return o.multiplyScalar(.25),o}function a(t,e){var n=0,i=0,o=0,r=0,s=e||t.nativeEvent.target;if(t||(t=window.event),t.pageX||t.pageY?(n=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),s.offsetParent)do{o+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent}while(s);return{x:n-o,y:i-r}}Object.defineProperty(e,"__esModule",{value:!0});var u,h=n(26),c=n(1),l=n(2)("CommunicationsView:Mouse"),d=1/30,f=-.25,p=100,y=[0,0,0,0],g=.1,m=.2,b=.2,v=.5;e.normalizeWheel=u,h.firefox?(l("Using mouse wheel for firefox"),e.normalizeWheel=u=i):h.msie&&+h.version>=11?(l("Using mouse wheel for IE 11"),e.normalizeWheel=u=r):h.msedge?(l("Using mouse wheel for MS EDGE"),e.normalizeWheel=u=s):(l("Using mouse wheel for Chrome"),e.normalizeWheel=u=o),e.eventElementPosition=a},function(t,e,n){"use strict";function i(t,e){var n=[];return e.forEach(function(e){t.find(function(t){return e instanceof t})&&n.push(e)}),n}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.filterQuery=i;var s=function(){function t(t,e){this.TL=null,this.TR=null,this.BL=null,this.BR=null;var n=t.mid;this.TL=new a(t.x,n.x,t.y,n.y,e),this.TR=new a(n.x,t.right,t.y,n.y,e),this.BL=new a(t.x,n.x,n.y,t.bottom,e),this.BR=new a(n.x,t.right,n.y,t.bottom,e)}return t.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),this.TL=null,this.TR=null,this.BL=null,this.BR=null},t}();e.Quadrants=s;var a=function(){function t(t,e,n,i,o){this.bounds=null,this.children=[],this.childrenProps=[],this.depth=0,this.nodes=null,arguments.length>=4?this.bounds=new r.Bounds(t,e,n,i):this.bounds=new r.Bounds(0,1,1,0),this.depth=o||0}return t.prototype.destroy=function(){this.children=null,this.bounds=null,this.nodes&&(this.nodes.destroy(),this.nodes=null)},t.prototype.add=function(t,e){return t.isInside(this.bounds)?this.doAdd(t):(this.cover(t),this.add(t,e))},t.prototype.addAll=function(t,e){var n=this;e=e||[];var i=Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=-Number.MAX_VALUE;t.forEach(function(t){t.x<i&&(i=t.x),t.right>s&&(s=t.right),t.bottom<o&&(o=t.bottom),t.y>a&&(a=t.y)}),this.cover(new r.Bounds(i,s,a,o)),t.forEach(function(t,e){return n.doAdd(t)})},t.prototype.cover=function(t){var e=this;if(!t.isInside(this.bounds)){this.bounds.encapsulate(t),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),this.nodes=null),n.forEach(function(t,n){return e.doAdd(t)})}},t.prototype.doAdd=function(t){if(this.nodes)return t.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(t):t.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(t):t.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(t):t.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(t):(this.children.push(t),!0);if(t.isInside(this.bounds))return this.children.push(t),this.children.length>5&&this.depth<10&&this.split(),!0;throw new Error("Child does not fit in node.")},t.prototype.gatherChildren=function(t){return t=t.concat(this.children),this.nodes&&(this.nodes.TL.gatherChildren(t),this.nodes.TR.gatherChildren(t),this.nodes.BL.gatherChildren(t),this.nodes.BR.gatherChildren(t)),t},t.prototype.gatherProps=function(t){var e=this;return this.children.forEach(function(n,i){t.push(e.childrenProps[i])}),this.nodes&&(this.nodes.TL.gatherProps(t),this.nodes.TR.gatherProps(t),this.nodes.BL.gatherProps(t),this.nodes.BR.gatherProps(t)),t},t.prototype.query=function(t,e){return t instanceof r.Bounds?t.hitBounds(this.bounds)?this.queryBounds(t,[],e):[]:this.bounds.containsPoint(t)?this.queryPoint(t,[],e):[]},t.prototype.queryBounds=function(t,e,n){return this.children.forEach(function(n,i){n.hitBounds(t)&&e.push(n)}),n&&n(this),this.nodes&&(t.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(t,e,n),t.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(t,e,n),t.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(t,e,n),t.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(t,e,n)),e},t.prototype.queryPoint=function(t,e,n){return this.children.forEach(function(n,i){n.containsPoint(t)&&e.push(n)}),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(t)&&this.nodes.TL.queryPoint(t,e,n),this.nodes.TR.bounds.containsPoint(t)&&this.nodes.TR.queryPoint(t,e,n),this.nodes.BL.bounds.containsPoint(t)&&this.nodes.BL.queryPoint(t,e,n),this.nodes.BR.bounds.containsPoint(t)&&this.nodes.BR.queryPoint(t,e,n)),e},t.prototype.split=function(){var t=this.gatherChildren([]);for(this.nodes=new s(this.bounds,this.depth+1),this.children=[],this.childrenProps=[];t.length>0;)this.doAdd(t.pop())},t.prototype.visit=function(t){var e=Boolean(t(this));this.nodes&&!e&&(this.nodes.TL.visit(t),this.nodes.TR.visit(t),this.nodes.BL.visit(t),this.nodes.BR.visit(t))},t}();e.Node=a;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(a);e.QuadTree=u},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=0,s=function(t){function e(e,n,i,o){var s=t.call(this,0,0,0,0)||this;return s._id=++r,s._radius=0,s._centerX=0,s._centerY=0,s._centerX=e,s._centerY=n,s._radius=i,s.d=o,s.updateBounds(),s}return i(e,t),Object.defineProperty(e.prototype,"values",{get:function(){return{radius:this._radius,x:this._centerX,y:this._centerY}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.updateBounds()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._centerX},set:function(t){this._centerX=t,this.updateBounds()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._centerY},set:function(t){this._centerY=t,this.updateBounds()},enumerable:!0,configurable:!0}),e.prototype.boundsInside=function(t){var e=this._radius*this._radius,n=t.x-this._centerX,i=t.y-this._centerY,o=i*i,r=n*n;return!(r+o>e)&&(n=t.right-this._centerX,!((r=n*n)+o>e)&&(i=t.bottom-this._centerY,o=i*i,!(r+o>e)&&(n=t.x-this._centerX,(r=n*n)+o<e)))},e.prototype.distanceTo=function(t,e){var n=this._centerX-t.x,i=this._centerY-t.y;return e?n*n+i*i:Math.sqrt(n*n+i*i)},e.getClosest=function(t,e){var n,i=Number.MAX_VALUE,o=0;return t.forEach(function(t){(o=t.distanceTo(e,!0))<i&&(n=t,i=o)}),n},e.prototype.hitCircle=function(t){var e=t._radius+this._radius;return e*=e,this.distanceTo({x:t._centerX,y:t._centerY},!0)<e},e.prototype.hitPoint=function(t){var e=this._radius*this._radius,n=t.x-this._centerX,i=t.y-this._centerY;return n*n+i*i<e},e.prototype.position=function(t,e,n){this._centerX=t,this._centerY=e,this._radius=n,this.updateBounds()},e.prototype.pointInside=function(t){var e=this._radius*this._radius,n=t.x-this._centerX,i=t.y-this._centerY;return n*n+i*i<e},e.prototype.updateBounds=function(){var t=this._radius;this.x=this._centerX-t,this.y=this._centerY-t,this.height=2*t,this.width=2*t},e.prototype.toString=function(){return"[Circle {x: "+this._centerX+", y: "+this._centerY+", r: "+this._radius+"}]"},e}(o.Bounds);e.Circle=s},function(t,e,n){"use strict";function i(t,e){var n,i=t.getLineStrip(),o=m.Point.getClosestIndex(e,i),r=Number.MAX_VALUE;return o>0&&(n=new g.Line(i[o],i[o-1]),r=n.distanceTo(e)),o<i.length-1&&(n=new g.Line(i[o],i[o+1]),r=Math.min(r,n.distanceTo(e))),r}function o(t,e){var n,i=t.getLineStrip(),o=m.Point.getClosestIndex(e,i),r=Number.MAX_VALUE;return o>0&&(n=new g.Line(i[o],i[o-1]),r=n.distanceTo(e)),o<i.length-1&&(n=new g.Line(i[o],i[o+1]),r=Math.min(r,n.distanceTo(e))),r}function r(t,e){return new g.Line(t.p1,t.p2).distanceTo(e)}function s(t){if(t.cachesSegments&&t.cachedSegments)return t.cachedSegments;for(var e=[],n=1/t.resolution,i=t.p1,o=t.p2,r=t.controlPoints[0],s=0,a=t.resolution;s<=a;++s)e.push(p.bezier2(n*s,i,o,r));return t.cachesSegments&&(t.cachedSegments=e),e}function a(t){if(t.cachesSegments&&t.cachedSegments)return t.cachedSegments;for(var e=[],n=1/t.resolution,i=t.p1,o=t.p2,r=t.controlPoints[0],s=t.controlPoints[1],a=0,u=t.resolution;a<=u;++a)e.push(p.bezier3(n*a,i,o,r,s));return t.cachesSegments&&(t.cachedSegments=e),e}function u(t){if(t.cachesSegments&&t.cachedSegments)return t.cachedSegments;b("CW");var e=new g.Line(t.p1,t.p2),n=m.Point.getDistance(t.p1,t.controlPoints[0]),i=m.Point.getMidpoint(t.p1,t.p2),o=m.Point.getDistance(i,t.p1);n<o&&(n=m.Point.getDistance(i,t.p1));var r=e.perpendicular,s=Math.sqrt(n*n-o*o),a={x:r.x*s+i.x,y:r.y*s+i.y};t.controlPoints[1]=a,b(" center of circle is %o  %o",a.x,a.y);var u=m.Point.getDirection(a,t.p1),h=Math.atan2(u.y,u.x),c=m.Point.getDirection(a,t.p2),l=Math.atan2(c.y,c.x);h<l&&(h+=2*Math.PI);var d=(h-l)/t.resolution;b("theta1 is %o, theta2 is %o",h,l);for(var f=[],p=0,y=t.resolution+1;p<y;++p)f.push({x:Math.cos(h-d*p)*n+a.x,y:Math.sin(h-d*p)*n+a.y});return t.cachesSegments&&(t.cachedSegments=f),b("Generated Circular Segments: %o dTheta: %o radius: %o",f,d,n),f}function h(t){if(t.cachesSegments&&t.cachedSegments)return t.cachedSegments;var e=new g.Line(t.p1,t.p2),n=m.Point.getDistance(t.p1,t.controlPoints[0]),i=m.Point.getMidpoint(t.p1,t.p2),o=m.Point.getDistance(i,t.p1);n<o&&(n=m.Point.getDistance(i,t.p1));var r=e.perpendicular,s=Math.sqrt(n*n-o*o),a={x:-r.x*s+i.x,y:-r.y*s+i.y};t.controlPoints[1]=a;var u=m.Point.getDirection(a,t.p1),h=Math.atan2(u.y,u.x),c=m.Point.getDirection(a,t.p2),l=Math.atan2(c.y,c.x);l<h&&(l+=2*Math.PI);for(var d=(l-h)/t.resolution,f=[],p=0,y=t.resolution+1;p<y;++p)f.push({x:Math.cos(h+d*p)*n+a.x,y:Math.sin(h+d*p)*n+a.y});return t.cachedSegments&&(t.cachedSegments=f),f}function c(t){return[t.p1,t.p2]}var l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var d,f=n(6),p=n(16),y=n(0),g=n(5),m=n(9),b=n(2)("bezier");!function(t){t[t.Bezier=0]="Bezier",t[t.CircularCCW=1]="CircularCCW",t[t.CircularCW=2]="CircularCW",t[t.Straight=3]="Straight"}(d=e.CurveType||(e.CurveType={}));var v=(_={},_[d.Bezier]=[null,s,a],_[d.CircularCW]=[null,u,u],_[d.CircularCCW]=[null,h,h],_[d.Straight]=[c],_),x=(M={},M[d.Bezier]=i,M[d.CircularCW]=o,M[d.CircularCCW]=o,M[d.Straight]=r,M),w=function(t){function e(e){var n=this,i=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=-Number.MAX_VALUE;return n=t.call(this,i,o,s,r)||this,n.cachesSegments=e.cacheSegments||!1,n.type=e.type,n.resolution=e.resolution||20,n.setPoints(e.start,e.end,e.controlPoints),n.distanceMethod=x[e.type],n}return l(e,t),Object.defineProperty(e.prototype,"values",{get:function(){return{controlPoints:this.controlPoints,p1:this.p1,p2:this.p2}},enumerable:!0,configurable:!0}),e.prototype.distanceTo=function(t){return this.distanceMethod(this,t)},e.getClosest=function(t,e){var n,i=Number.MAX_VALUE,o=0;return t.forEach(function(t){(o=t.distanceTo(e))<i&&(n=t,i=o)}),n},e.prototype.getLineStrip=function(){return this.segmentMethod(this)},e.prototype.setPoints=function(t,e,n){this.p1=t,this.p2=e,0===n.length&&b("p1: %o, p2:%o",t,e);var i=v[this.type];if(n){this.controlPoints=f.clone(n);var o=n.length;if(o>i.length&&(o=i.length-1),this.segmentMethod=i[o],!this.segmentMethod)throw new Error("An Invalid number of control points was provided to a curved line. You must have at LEAST 1 control point. Or 0 for a straight line");this.type===d.Bezier?this.encapsulatePoints(n):this.type!==d.CircularCCW&&this.type!==d.CircularCW||this.encapsulatePoints(this.getLineStrip())}this.encapsulatePoint(t),this.encapsulatePoint(e),this.cachedSegments=null},e}(y.Bounds);e.CurvedLine=w;var _,M},function(t,e,n){"use strict";function i(t,e,n,i){var o=t*t,r=1-t,s=r*r;return{x:e.x*s+2*i.x*r*t+n.x*o,y:e.y*s+2*i.y*r*t+n.y*o}}function o(t,e,n,i,o){var r=t*t,s=r*t,a=1-t,u=a*a,h=u*a;return{x:e.x*h+3*i.x*u*t+3*o.x*a*r+n.x*s,y:e.y*h+3*i.y*u*t+3*o.y*a*r+n.y*s}}Object.defineProperty(e,"__esModule",{value:!0}),e.bezier2=i,e.bezier3=o},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(5),r=function(t){function e(e,n,i,o,r,s,a,u,h,c,l,d){var f=t.call(this,e,n)||this;return f.a=0,f.b=0,f.g=0,f.r=1,f.a2=0,f.b2=0,f.g2=0,f.r2=1,f.cull=!0,f.thickness=1,Object.assign(f,{a:a,a2:l,b:s,b2:c,d:i,g:r,g2:h,r:o,r2:u}),void 0!==d&&(f.thickness=d),f}return i(e,t),e.prototype.clone=function(t){return Object.assign(new e(this.p1,this.p2,this.d,this.r,this.g,this.b,this.a,this.r2,this.g2,this.b2,this.a2),this,t)},e}(o.Line);e.LineShape=r},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o,r=n(1),s=n(0);!function(t){t[t.BottomLeft=0]="BottomLeft",t[t.BottomRight=1]="BottomRight",t[t.Custom=2]="Custom",t[t.Middle=3]="Middle",t[t.MiddleBottom=4]="MiddleBottom",t[t.MiddleLeft=5]="MiddleLeft",t[t.MiddleRight=6]="MiddleRight",t[t.MiddleTop=7]="MiddleTop",t[t.TopLeft=8]="TopLeft",t[t.TopRight=9]="TopRight"}(o=e.AnchorPosition||(e.AnchorPosition={}));var a=(h={},h[o.BottomLeft]=function(t){return{x:0,y:0}},h[o.BottomRight]=function(t){return{x:t.getSize().width,y:0}},h[o.Custom]=function(t){return{x:0,y:t.getSize().height}},h[o.Middle]=function(t){return{x:t.getSize().width/2,y:t.getSize().height/2}},h[o.MiddleBottom]=function(t){return{x:t.getSize().width/2,y:0}},h[o.MiddleLeft]=function(t){return{x:0,y:t.getSize().height/2}},h[o.MiddleRight]=function(t){return{x:t.getSize().width,y:t.getSize().height/2}},h[o.MiddleTop]=function(t){return{x:t.getSize().width/2,y:t.getSize().height}},h[o.TopLeft]=function(t){return{x:0,y:t.getSize().height}},h[o.TopRight]=function(t){return{x:t.getSize().width,y:t.getSize().height}},h),u=function(t){function e(e,n,i,r){void 0===r&&(r=o.Middle);var s=t.call(this,0,0,0,0)||this;return s.setSize(n),s.setAnchor(r),s.setLocation(e),s.setRotation(i),s.update(),s}return i(e,t),e.prototype.calculateAnchor=function(t){this.anchor=a[t](this)},e.prototype.getSize=function(){return this.size},e.prototype.setAnchor=function(t,e){if(void 0===t&&(t=o.Middle),this.anchorType=t,e)return this.anchorType=o.Custom,void(this.anchor=e);this.calculateAnchor(t)},e.prototype.getAnchorType=function(){return this.anchorType},e.prototype.setLocation=function(t){this.location=t},e.prototype.getLocation=function(){return this.location},e.prototype.setRotation=function(t){this.rotation=t},e.prototype.getRotation=function(){return this.rotation},e.prototype.getDirection=function(){var t=this.rotation;return{x:Math.cos(t),y:Math.sin(t)}},e.prototype.setSize=function(t){this.size=t,this.base=[new r.Vector4(0,t.height,0,1),new r.Vector4(t.width,t.height,0,1),new r.Vector4(0,0,0,1),new r.Vector4(t.width,0,0,1)]},e.prototype.update=function(){var t=(new r.Matrix4).makeTranslation(this.anchor.x,-this.anchor.y,0),e=(new r.Matrix4).makeRotationZ(this.rotation),n=(new r.Matrix4).makeTranslation(this.location.x,this.location.y,0);this.transform=(new r.Matrix4).multiply(n).multiply(e).multiply(t),this.TL=this.base[0].clone().applyMatrix4(this.transform),this.TR=this.base[1].clone().applyMatrix4(this.transform),this.BL=this.base[2].clone().applyMatrix4(this.transform),this.BR=this.base[3].clone().applyMatrix4(this.transform),this.x=this.TL.x,this.y=this.TL.y,this.width=1,this.height=1,this.encapsulatePoints([this.TR,this.BL,this.BR])},e}(s.Bounds);e.RotateableQuad=u;var h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n,i){this.scaleX=1,this.scaleY=1;var o=document.createElement("canvas");o&&(this.scaleX=n||this.scaleX,this.scaleY=i||this.scaleY,o.width=t*this.scaleX,o.height=e*this.scaleY,this.context=o.getContext("2d"),this.canvas=o)}return t.prototype.getContentScale=function(){return{x:this.scaleX,y:this.scaleY}},t.prototype.getContentSize=function(){return{height:this.canvas.height,width:this.canvas.width}},t.prototype.getWidth=function(){return this.canvas.width/this.scaleX},t.prototype.getHeight=function(){return this.canvas.height/this.scaleY},t}();e.Sprite=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(21)),i(n(27)),i(n(32)),i(n(41)),i(n(42))},function(t,e,n){"use strict";function i(t){return t?t>0?1:t<0?-1:0:0}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r,s=n(6),a=n(22),u=n(1),h=n(10),c=n(8),l=n(0),d=n(12),f=n(13),p=n(2)("webgl-surface:GPU"),y=n(2)("webgl-surface:Camera"),g=n(2)("webgl-surface:Labels");!function(t){t[t.INITIALIZE=0]="INITIALIZE",t[t.BUFFERCHANGES=1]="BUFFERCHANGES",t[t.CAMERA=2]="CAMERA",t[t.LABELS=3]="LABELS",t[t.COLORS=4]="COLORS"}(r=e.BaseApplyPropsMethods||(e.BaseApplyPropsMethods={}));var m;!function(t){t[t.CONTEXT=0]="CONTEXT",t[t.INERTIA=1]="INERTIA",t[t.POSITION=2]="POSITION",t[t.ZOOM=3]="ZOOM"}(m=e.BaseAnimatedMethods||(e.BaseAnimatedMethods={}));var b=(new u.Color).setRGB(38/255,50/255,78/255),v=new u.Vector3,x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.atlasManager=new h.AtlasManager(2048,2048),e.atlasNames={colors:"colors",labels:"labels"},e.animatedMethodList=[],e.animatedMethodBreak=!1,e.distance=0,e.camera=null,e.disableMouseInteraction=0,e.sizeCamera=null,e.currentZoom=1,e.destinationX=0,e.destinationY=0,e.destinationZoom=1,e.isPanning=!1,e.lastMousePosition={x:0,y:0},e.propsMethodList=[],e.inertia=null,e.inertiaBuild=1.5,e.inertiaDecay=.9,e.inertiaMax=100,e.quadTree=null,e.shiftIsDown=!1,e.stop=!1,e.currentX=0,e.currentY=0,e.targetZoom=1,e.previousZoomToFit=0,e.zoomTargetX=0,e.zoomTargetY=0,e.animating=!1,e.labels=[],e.labelsReady=!1,e.colors=[],e.colorsReady=!1,e.currentHoverItems=[],e.animate=function(){if(!e.stop){requestAnimationFrame(function(){return e.animate()});var t,n=!1;e.animatedMethodList.some(function(i){return t=i(),n||(n=t.doDraw),t.stop&&(e.stop=!0),!!t.break})||(e.updateCameraUniforms(),e.disableMouseInteraction>0&&e.disableMouseInteraction--,(n||e.forceDraw)&&(e.forceDraw=!1,e.emitViewport(),e.draw()))}},e.applyProps=function(t){p("Applying props");var n;e.propsMethodList.some(function(e){return n=e(t),!!n.break}),y("current cam",e.currentX,e.currentY,e.destinationX,e.destinationY),y("Zoom Target: [%o, %o]",e.zoomTargetX,e.zoomTargetY),y("Last Mouse: [%o, %o]",e.lastMousePosition.x,e.lastMousePosition.y)},e.draw=function(){e.renderer.render(e.scene,e.camera)},e.init=function(t,n,i){if(t&&!e.scene&&(e.renderEl=t,0!==n&&0!==i)){p("Initializing GPU objects el: %o width: %o height: %o",t,n,i),e.ctx={height:i,heightHalf:i/2,width:n,widthHalf:n/2},e.initCamera(),window.scene=e.scene=new u.Scene,e.initBuffers(),e.renderer=new u.WebGLRenderer({antialias:!0}),p("Window Pixel Ratio: %o",window.devicePixelRatio),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(n,i),e.renderer.setClearColor(b),e.renderer.setFaceCulling(u.CullFaceNone);t.appendChild(e.renderer.domElement)}},e.initCamera=function(){p("Initializing Camera");var t=e.ctx.height,n=t,i=e.ctx.width,o=i/t,r={aspectRatio:o,bottom:-n/2,far:1e7,left:-o*n/2,near:-100,right:o*n/2,top:n/2,viewSize:n};e.camera=new u.OrthographicCamera(r.left,r.right,r.top,r.bottom,r.near,r.far),e.sizeCamera=new u.OrthographicCamera(r.left,r.right,r.top,r.bottom,r.near,r.far),e.camera.position.z=300,e.sizeCamera.position.set(0,0,300)},e.resizeContext=function(){var t=e.props.width,n=e.props.height;if(!e.renderer)return!1;var i=e.renderer.getSize();if(i.width===t&&i.height===n)return!1;p("RENDERER RESIZE"),e.ctx={height:n,heightHalf:n/2,width:t,widthHalf:t/2};var o=e.camera.zoom,r=e.camera.position.clone();return e.initCamera(),e.camera.zoom=o,e.camera.position.set(r.x,r.y,r.z),e.camera.updateProjectionMatrix(),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(t,n),e.renderer.setClearColor((new u.Color).setRGB(38/255,50/255,78/255)),e.renderer.setFaceCulling(u.CullFaceNone),!0},e.emitViewport=function(){var t=e.screenToWorld(0,0),n=e.screenToWorld(e.ctx.width,e.ctx.height);e.camera.updateMatrixWorld(!0);var i=e.quadTree.query(new l.Bounds(t.x,n.x,t.y,n.y));e.onViewport(i,e.projection,e.ctx)},e.handleMouseDown=function(t){e.disableMouseInteraction>0||(e.isPanning=!0,e.distance=0,e.onMouseDown())},e.handleMouseOut=function(t){e.disableMouseInteraction>0||(e.isPanning=!1,e.distance=0,e.onMouseOut())},e.handleMouseUp=function(t){if(!(e.disableMouseInteraction>0)){e.isPanning=!1;var n=d.eventElementPosition(t),i=e.screenToWorld(n.x,n.y);if(e.distance<5){for(var o=[],r=e.quadTree.query(i),s=0,a=r;s<a.length;s++){var u=a[s];u.pointInside(i)&&o.push(u)}o.length?e.onMouseUp(t,o,n,i,e.projection):e.onMouseUp(t,null,n,i,e.projection)}}},e.handleMouseMove=function(t){if(!(e.disableMouseInteraction>0)){var n=e.props.onMouse,o=e.props.zoom,r=d.eventElementPosition(t),s=e.screenToWorld(r.x,r.y);if(e.distance++,e.isPanning){var a=(r.x-e.lastMousePosition.x)/e.targetZoom,u=-(r.y-e.lastMousePosition.y)/e.targetZoom,h=e.willPan(a,u);a=h.x,u=h.y,e.destinationX-=a,e.destinationY-=u,e.inertia=e.inertia||{x:0,y:0},i(a)!==i(e.inertia.x)&&(e.inertia.x=0),i(u)!==i(e.inertia.y)&&(e.inertia.y=0),e.inertia.x=a*e.inertiaBuild,e.inertia.y=u*e.inertiaBuild;var c=e.inertiaMax/o,l=Math.sqrt(e.inertia.x*e.inertia.x+e.inertia.y*e.inertia.y);l>c&&(e.inertia.x=e.inertia.x/l*c,e.inertia.y=e.inertia.y/l*c)}if(e.quadTree&&!e.isPanning){for(var f=[],p=e.quadTree.query(s),y=[],g=0,m=p;g<m.length;g++){var b=m[g];b.pointInside(s)&&(y.push(b),f.push(b))}e.onMouseHover(y,r,s,e.projection);for(var v=[],x=0,w=e.currentHoverItems;x<w.length;x++){var b=w[x];f.indexOf(b)<0&&v.push(b)}e.onMouseLeave(v,r,s,e.projection),e.currentHoverItems=f}n&&e.onMouse(r,s,e.isPanning),e.lastMousePosition=r}},e.applyRef=function(t){e.init(t,e.props.width,e.props.height),e.applyProps(e.props)},e}return o(e,t),e.prototype.animatedMethods=function(t,e){return e},e.prototype.animatedMethodsBase=function(){var t=this;return e={},e[m.CONTEXT]=function(){var e={break:!1,doDraw:!1};return t.resizeContext()&&(e.doDraw=!0),t.quadTree||(e.break=!0),e},e[m.INERTIA]=function(){return t.isPanning||t.inertia&&(t.inertia.x*=t.inertiaDecay,t.inertia.y*=t.inertiaDecay,t.inertia.x*t.inertia.x+t.inertia.y*t.inertia.y<1&&(t.inertia=null)),{doDraw:!1}},e[m.POSITION]=function(){var e={doDraw:t.currentX!==t.destinationX||t.currentY!==t.destinationY};return t.currentX=t.destinationX,t.currentY=t.destinationY,t.positionCamera(t.currentX,t.currentY),e},e[m.ZOOM]=function(){var e={doDraw:!1},n=1*t.destinationZoom,i=Math.abs(n-t.targetZoom);i>.001?(t.targetZoom=t.targetZoom+(n-t.targetZoom)/3,e.doDraw=!0):0!==i&&(t.targetZoom=n,e.doDraw=!0);var o=t.zoomTargetX,r=t.zoomTargetY,s=t.worldToScreen(o,r);t.zoomCamera(t.targetZoom);var a=t.worldToScreen(o,r),u=-(a.x-s.x)/t.targetZoom,h=(a.y-s.y)/t.targetZoom;return t.currentX-=u,t.currentY-=h,t.destinationX-=u,t.destinationY-=h,t.positionCamera(t.currentX,t.currentY),e},e;var e},e.prototype.applyColorBufferChanges=function(t){},e.prototype.applyLabelBufferChanges=function(t){},e.prototype.applyPropsMethods=function(t,e){return e},e.prototype.applyPropsMethodsBase=function(){var t=this;return e={},e[r.INITIALIZE]=function(e){var n=e.height,i=e.width;if(t.init(t.renderEl,i,n),!t.renderEl||0===i||0===n)return{break:!0};if(t.camera){var o=t.screenToWorld(t.lastMousePosition.x,t.lastMousePosition.y);t.zoomTargetX=o.x,t.zoomTargetY=o.y}return p("props",e),{}},e[r.LABELS]=function(e){var n={};if(e.labels&&e.labels!==t.labels){g("Labels are being comitted to an Atlas %o",e.labels),t.labelsReady=!1,t.labels=e.labels,t.atlasManager.getAtlasTexture(t.atlasNames.labels)&&t.atlasManager.destroyAtlas(t.atlasNames.labels);var i=e.labels.map(function(t){return new c.AtlasTexture(null,t)});g("Creating the atlas for labels based on these textures %o",i),t.atlasManager.createAtlas(t.atlasNames.labels,i).then(function(){g("Labels rasterized within the atlas!"),t.forceDraw=!0,t.labelsReady=!0,t.applyProps(t.props)})}return n},e[r.COLORS]=function(e){var n={};return e.colors&&e.colors!==t.colors&&(g("Colors are being comitted to an Atlas %o",e.colors),t.colorsReady=!1,t.colors=e.colors,t.atlasManager.getAtlasTexture(t.atlasNames.colors)&&t.atlasManager.destroyAtlas(t.atlasNames.colors),g("Creating the atlas for colors based on these colors %o",t.colors),t.atlasManager.createAtlas(t.atlasNames.colors,null,t.colors).then(function(){g("Colors rasterized within the atlas!"),t.forceDraw=!0,t.colorsReady=!0,t.applyProps(t.props)})),n},e[r.BUFFERCHANGES]=function(e){return t.applyBufferChanges(e),t.labelsReady&&(g("labels changed %o",e),t.applyLabelBufferChanges(e)),t.colorsReady&&t.applyColorBufferChanges(e),{}},e[r.CAMERA]=function(e){if(t.destinationZoom=e.zoom,e.viewport&&e.viewport!==t.appliedViewport&&t.quadTree){y("Applying viewport to camera: %o World Space Bounds: %o",e.viewport,t.quadTree.bounds);var n=e.viewport.mid;t.currentX=t.destinationX=n.x,t.currentY=t.destinationY=n.y;var i=t.ctx.width/e.viewport.width,o=t.ctx.height/e.viewport.height,r=Math.min(i,o);t.destinationZoom=r/1,t.targetZoom=1*t.destinationZoom*1.001,t.zoomTargetX=n.x,t.zoomTargetY=n.y,t.lastMousePosition.x=t.ctx.widthHalf,t.lastMousePosition.y=t.ctx.heightHalf,t.positionCamera(t.currentX,t.currentY),t.zoomCamera(t.targetZoom),t.updateCameraUniforms(),e.onZoomRequest&&(e.onZoomRequest(t.destinationZoom),y("Requesting zoom level",t.destinationZoom));t.disableMouseInteraction=10,t.appliedViewport=e.viewport,y("init cam",t.currentX,t.currentY)}return t.quadTree||(t.quadTree=new f.QuadTree(0,1,1,0)),{}},e;var e},e.prototype.applyBufferChanges=function(t){},e.prototype.componentDidMount=function(){this.animate()},e.prototype.componentWillMount=function(){this.projection={screenSizeToWorld:this.screenSizeToWorld.bind(this),screenToWorld:this.screenToWorld.bind(this),worldSizeToScreen:this.worldSizeToScreen.bind(this),worldToScreen:this.worldToScreen.bind(this)};var t=this.applyPropsMethodsBase();this.propsMethodList=this.applyPropsMethods(t,[t[r.INITIALIZE],t[r.LABELS],t[r.COLORS],t[r.BUFFERCHANGES],t[r.CAMERA]]);var e=this.animatedMethodsBase();this.animatedMethodList=this.animatedMethods(e,[e[m.CONTEXT],e[m.INERTIA],e[m.POSITION],e[m.ZOOM]])},e.prototype.componentWillReceiveProps=function(t){this.applyProps(t)},e.prototype.componentWillUnmount=function(){this.stop=!0,this.quadTree&&this.quadTree.destroy(),this.quadTree=null,this.camera=null,this.sizeCamera=null,this.ctx=null,this.renderEl=null,this.renderer=null,this.scene=null},e.prototype.initBuffers=function(){},e.prototype.onMouse=function(t,e,n){},e.prototype.onMouseDown=function(){},e.prototype.onMouseOut=function(){},e.prototype.onMouseUp=function(t,e,n,i,o){},e.prototype.onMouseHover=function(t,e,n,i){},e.prototype.onMouseLeave=function(t,e,n,i){},e.prototype.onViewport=function(t,e,n){},e.prototype.positionCamera=function(t,e){this.camera&&this.camera.position.set(Math.floor(t),Math.floor(e),this.camera.position.z)},e.prototype.screenToWorld=function(t,e,n){return v.set(t/this.ctx.width*2-1,-e/this.ctx.height*2+1,0),v.unproject(this.camera),n=n||{x:0,y:0},n.x=v.x,n.y=v.y,n},e.prototype.screenSizeToWorld=function(t,e,n){return n=n||new l.Bounds(0,0,0,0),n.width=t/(this.sizeCamera?this.sizeCamera.zoom:1),n.height=e/(this.sizeCamera?this.sizeCamera.zoom:1),n},e.prototype.worldToScreen=function(t,e,n){return v.set(t,e,0),v.project(this.camera),n=s.merge(n||{},{x:v.x*this.ctx.widthHalf+this.ctx.widthHalf,y:-v.y*this.ctx.heightHalf+this.ctx.heightHalf})},e.prototype.worldSizeToScreen=function(t,e,n){return n=n||new l.Bounds(0,0,0,0),n.width=t*this.sizeCamera.zoom,n.height=e*this.sizeCamera.zoom,n},e.prototype.zoomCamera=function(t){this.camera.zoom=t,this.sizeCamera.zoom=t,this.camera.updateProjectionMatrix(),this.sizeCamera.updateProjectionMatrix()},e.prototype.updateCameraUniforms=function(){},e.prototype.shouldComponentUpdate=function(t){return this.props.width!==t.width||this.props.height!==t.height},e.prototype.willPan=function(t,e){return new u.Vector3(t,e,0)},e.prototype.render=function(){var t=this,e=this.props,n=e.width,i=e.height;return a.createElement("div",{onMouseDown:this.handleMouseDown,onMouseOut:this.handleMouseOut,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseOut,onMouseMove:this.handleMouseMove,onDoubleClick:function(e){t.props.onDoubleClick&&t.props.onDoubleClick(e)},style:{position:"relative",width:n,height:i}},a.createElement("div",{ref:this.applyRef}))},e}(a.Component);e.WebGLSurface=x},function(t,e){t.exports=i},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function r(t){if(l===clearTimeout)return clearTimeout(t);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){y&&f&&(y=!1,f.length?p=f.concat(p):g=-1,p.length&&a())}function a(){if(!y){var t=o(s);y=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,y=!1,r(t)}}function u(t,e){this.fun=t,this.array=e}function h(){}var c,l,d=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(t){l=i}}();var f,p=[],y=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||y||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e,n){function i(t){var n,i=0;for(n in t)i=(i<<5)-i+t.charCodeAt(n),i|=0;return e.colors[Math.abs(i)%e.colors.length]}function o(t){function n(){if(n.enabled){var t=n,i=+new Date,o=i-(h||i);t.diff=o,t.prev=h,t.curr=i,h=i;for(var r=new Array(arguments.length),s=0;s<r.length;s++)r[s]=arguments[s];r[0]=e.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var a=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,function(n,i){if("%%"===n)return n;a++;var o=e.formatters[i];if("function"==typeof o){var s=r[a];n=o.call(t,s),r.splice(a,1),a--}return n}),e.formatArgs.call(t,r);(n.log||e.log||console.log.bind(console)).apply(t,r)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=i(t),"function"==typeof e.init&&e.init(n),n}function r(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length,o=0;o<i;o++)n[o]&&(t=n[o].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1}function u(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o.default=o,e.coerce=u,e.disable=s,e.enable=r,e.enabled=a,e.humanize=n(25),e.names=[],e.skips=[],e.formatters={};var h},function(t,e){function n(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*h;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function i(t){return t>=h?Math.round(t/h)+"d":t>=u?Math.round(t/u)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return r(t,h,"day")||r(t,u,"hour")||r(t,a,"minute")||r(t,s,"second")||t+" ms"}function r(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,u=60*a,h=24*u,c=365.25*h;t.exports=function(t,e){e=e||{};var r=typeof t;if("string"===r&&t.length>0)return n(t);if("number"===r&&!1===isNaN(t))return e.long?o(t):i(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e){t.exports=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(3)),i(n(28)),i(n(29)),i(n(30)),i(n(31))},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(4),s=n(3),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(t,e){this.bufferItems=r.BufferUtil.makeBufferItems(),this.bufferItems.attributes=[{defaults:[0,0,0],name:"position",size:r.AttributeSize.THREE},{defaults:[0],name:"startColorPick",size:r.AttributeSize.ONE},{defaults:[0],name:"endColorPick",size:r.AttributeSize.ONE},{defaults:[1],name:"normalDirection",size:r.AttributeSize.ONE},{defaults:[0,0,0,0],name:"endPoints",size:r.AttributeSize.FOUR},{defaults:[0],name:"halfLinewidth",size:r.AttributeSize.ONE}];var n=e;this.bufferItems.geometry=r.BufferUtil.makeBuffer(6*n,this.bufferItems.attributes),this.bufferItems.system=new o.Mesh(this.bufferItems.geometry,t),this.bufferItems.system.frustumCulled=!1,this.bufferItems.system.drawMode=o.TriangleStripDrawMode},e.prototype.update=function(t,e,n){if(!t)return!1;if(t&&t.length>0&&e){var i=t[0].startColor,o=i.base,s=this.bufferItems.system.material,a=s.uniforms,u=e.getAtlasTexture(o.atlasReferenceID);a.colorAtlas.value=u,a.colorsPerRow.value=o.colorsPerRow,a.firstColor.value=[o.firstColor.x,o.firstColor.y],a.nextColor.value=[o.nextColor.x,o.nextColor.y],a.controlPoint.value=[n.x,n.y],u.needsUpdate=!0}var h,c,l,d,f,p=1,y=15,g=!1;r.BufferUtil.beginUpdates();for(var m=this,b=0,v=t;b<v.length;b++){var x=v[b];if("break"===function(e){if(f=e.startColor.base.opacity,l=e.startColor.base,d=e.endColor.base,p=e.lineWidth/2,y=e.resolution,h=e.p1,c=e.p2,!(g=r.BufferUtil.updateBuffer(t,m.bufferItems,6,y,function(t,n,i,o,r,s,a,u,f,g,m,b,v){n[i]=(t+1)/y,n[++i]=y,n[++i]=e.depth,b[v]=p,r+=1,a+=1,u[f]=1,g[m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y,n[++i]=(t+1)/y,n[++i]=y,n[++i]=e.depth,b[++v]=p,u[++f]=1,g[++m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y,o[r]=l.colorIndex,s[a]=d.colorIndex,n[++i]=(t+1)/y,n[++i]=y,n[++i]=e.depth,b[++v]=p,u[++f]=-1,g[++m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y,o[++r]=l.colorIndex,s[++a]=d.colorIndex,n[++i]=t/y,n[++i]=y,n[++i]=e.depth,b[++v]=p,u[++f]=1,g[++m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y,o[++r]=l.colorIndex,s[++a]=d.colorIndex,n[++i]=t/y,n[++i]=y,n[++i]=e.depth,b[++v]=p,u[++f]=-1,g[++m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y,o[++r]=l.colorIndex,s[++a]=d.colorIndex,n[++i]=t/y,n[++i]=y,n[++i]=e.depth,b[++v]=p,r+=1,a+=1,u[++f]=-1,g[++m]=h.x,g[++m]=h.y,g[++m]=c.x,g[++m]=c.y})))return"break"}(x))break}var w=r.BufferUtil.endUpdates();return g?this.bufferItems.geometry.setDrawRange(0,6*w):0===t.length&&this.bufferItems.geometry.setDrawRange(0,0),g},e}(s.BaseBuffer);e.SharedControlCurvedLineBuffer=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(4),s=n(3),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(t,e){this.bufferItems=r.BufferUtil.makeBufferItems(),this.bufferItems.attributes=[{defaults:[0,0,0],name:"position",size:r.AttributeSize.THREE},{defaults:[0,0,0,1],name:"customColor",size:r.AttributeSize.FOUR},{defaults:[1],name:"normalDirection",size:r.AttributeSize.ONE},{defaults:[0,0,0,0],name:"endPoints",size:r.AttributeSize.FOUR},{defaults:[0,0],name:"controlPoint",size:r.AttributeSize.TWO},{defaults:[0],name:"halfLinewidth",size:r.AttributeSize.ONE}];var n=e;this.bufferItems.geometry=r.BufferUtil.makeBuffer(6*n,this.bufferItems.attributes),this.bufferItems.system=new o.Mesh(this.bufferItems.geometry,t),this.bufferItems.system.frustumCulled=!1,this.bufferItems.system.drawMode=o.TriangleStripDrawMode},e.prototype.update=function(t){if(!t)return!1;var e,n,i,o,s=1,a=15,u=!1;r.BufferUtil.beginUpdates();for(var h=this,c=0,l=t;c<l.length;c++){var d=l[c];if("break"===function(c){if(o=c.startColor.base.opacity,i=c.startColor.base.color,s=c.lineWidth/2,a=c.resolution,e=c.p1,n=c.p2,!(u=r.BufferUtil.updateBuffer(t,h.bufferItems,6,a,function(t,r,u,h,l,d,f,p,y,g,m,b,v){r[u]=(t+1)/a,r[++u]=a,r[++u]=c.depth,b[v]=s,l+=4,d[f]=1,p[y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y,r[++u]=(t+1)/a,r[++u]=a,r[++u]=c.depth,b[++v]=s,d[++f]=1,p[++y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[++m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y,h[l]=i.r,h[++l]=i.g,h[++l]=i.b,h[++l]=o,r[++u]=(t+1)/a,r[++u]=a,r[++u]=c.depth,b[++v]=s,d[++f]=-1,p[++y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[++m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y,h[++l]=i.r,h[++l]=i.g,h[++l]=i.b,h[++l]=o,r[++u]=t/a,r[++u]=a,r[++u]=c.depth,b[++v]=s,d[++f]=1,p[++y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[++m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y,h[++l]=i.r,h[++l]=i.g,h[++l]=i.b,h[++l]=o,r[++u]=t/a,r[++u]=a,r[++u]=c.depth,b[++v]=s,d[++f]=-1,p[++y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[++m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y,h[++l]=i.r,h[++l]=i.g,h[++l]=i.b,h[++l]=o,r[++u]=t/a,r[++u]=a,r[++u]=c.depth,b[++v]=s,l+=4,d[++f]=-1,p[++y]=e.x,p[++y]=e.y,p[++y]=n.x,p[++y]=n.y,g[++m]=c.controlPoints[0].x,g[++m]=c.controlPoints[0].y})))return"break"}(d))break}var f=r.BufferUtil.endUpdates();return u?this.bufferItems.geometry.setDrawRange(0,6*f):0===t.length&&this.bufferItems.geometry.setDrawRange(0,0),u},e}(s.BaseBuffer);e.SimpleStaticBezierLineBuffer=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(4),s=n(3),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(t,e){this.bufferItems=r.BufferUtil.makeBufferItems(),this.bufferItems.attributes=[{defaults:[0,0,0],name:"position",size:r.AttributeSize.THREE},{defaults:[0,0,0,1],name:"customColor",size:r.AttributeSize.FOUR}];var n=e;this.bufferItems.geometry=r.BufferUtil.makeBuffer(6*n,this.bufferItems.attributes),this.bufferItems.system=new o.Mesh(this.bufferItems.geometry,t),this.bufferItems.system.frustumCulled=!1,this.bufferItems.system.drawMode=o.TriangleStripDrawMode},e.prototype.update=function(t){var e=!1,n=0;r.BufferUtil.beginUpdates();for(var i,o,s,a,u,h,c=this,l=0,d=t;l<d.length;l++){var f=d[l];if("break"===function(l){var d=l.getTriangleStrip();if(u=l.startColor.base.color,h=l.startColor.base.opacity,!(e=r.BufferUtil.updateBuffer(t,c.bufferItems,6,d.length/4,function(t,e,r,c,f){n=4*t,i=d[n],o=d[n+1],s=d[n+2],a=d[n+3],e[r]=i.x,e[++r]=i.y,e[++r]=l.depth,f+=4,e[++r]=i.x,e[++r]=i.y,e[++r]=l.depth,c[f]=u.r,c[++f]=u.g,c[++f]=u.b,c[++f]=h,e[++r]=o.x,e[++r]=o.y,e[++r]=l.depth,c[++f]=u.r,c[++f]=u.g,c[++f]=u.b,c[++f]=h,e[++r]=s.x,e[++r]=s.y,e[++r]=l.depth,c[++f]=u.r,c[++f]=u.g,c[++f]=u.b,c[++f]=h,e[++r]=a.x,e[++r]=a.y,e[++r]=l.depth,c[++f]=u.r,c[++f]=u.g,c[++f]=u.b,c[++f]=h,e[++r]=a.x,e[++r]=a.y,e[++r]=l.depth,f+=4})))return"break"}(f))break}var p=r.BufferUtil.endUpdates();return e?this.bufferItems.geometry.setDrawRange(0,6*p):0===t.length?this.bufferItems.geometry.setDrawRange(0,0):0===t.length&&this.bufferItems.geometry.setDrawRange(0,0),e},e}(s.BaseBuffer);e.SimpleStaticLineBuffer=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(4),s=n(3),a=n(2)("simple-label-buffer"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(t,e){this.bufferItems=r.BufferUtil.makeBufferItems(),this.bufferItems.attributes=[{defaults:[0,0,0],name:"position",size:r.AttributeSize.THREE},{defaults:[0,0,0],name:"customColor",size:r.AttributeSize.THREE},{defaults:[0,0,1],name:"texCoord",size:r.AttributeSize.THREE}];var n=e;this.bufferItems.geometry=r.BufferUtil.makeBuffer(6*n,this.bufferItems.attributes),this.bufferItems.system=new o.Mesh(this.bufferItems.geometry,t),this.bufferItems.system.frustumCulled=!1,this.bufferItems.system.drawMode=o.TriangleStripDrawMode},e.prototype.update=function(t){var e,n;if(!t)return!1;var i=r.BufferUtil.updateBuffer(t,this.bufferItems,6,t.length,function(i,o,r,s,u,h,c){e=t[i],n=e.rasterizedLabel,a("texture is %o",n),e.update(),o[r]=e.TR.x,o[++r]=e.TR.y,o[++r]=e.depth,u+=3,c+=3,o[++r]=e.TR.x,o[++r]=e.TR.y,o[++r]=e.depth,h[c]=n.atlasTR.x,h[++c]=n.atlasTR.y,h[++c]=e.a,s[u]=e.r,s[++u]=e.g,s[++u]=e.b,o[++r]=e.BR.x,o[++r]=e.BR.y,o[++r]=e.depth,h[++c]=n.atlasBR.x,h[++c]=n.atlasBR.y,h[++c]=e.a,s[u]=e.r,s[++u]=e.g,s[++u]=e.b,o[++r]=e.TL.x,o[++r]=e.TL.y,o[++r]=e.depth,h[++c]=n.atlasTL.x,h[++c]=n.atlasTL.y,h[++c]=e.a,s[++u]=e.r,s[++u]=e.g,s[++u]=e.b,o[++r]=e.BL.x,o[++r]=e.BL.y,o[++r]=e.depth,h[++c]=n.atlasBL.x,h[++c]=n.atlasBL.y,h[++c]=e.a,s[++u]=e.r,s[++u]=e.g,s[++u]=e.b,o[++r]=e.BL.x,o[++r]=e.BL.y,o[++r]=e.depth});return this.bufferItems.geometry.setDrawRange(0,6*t.length),i},e}(s.BaseBuffer);e.SimpleStaticLabelBuffer=u},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(33)),i(n(34)),i(n(35)),i(n(36)),i(n(37)),i(n(38)),i(n(17)),i(n(39)),i(n(40)),i(n(10)),i(n(8)),i(n(19))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.base=t}return t}();e.ReferenceColor=i},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(7),r=n(14),s=function(t){function e(e,n,i,o,r,s,a){var u=t.call(this,e,n,i,a)||this;if(u.r=0,u.g=0,u.b=0,u.a=0,u.r2=0,u.g2=0,u.b2=0,u.a2=0,u.alpha=0,u.innerRadius=0,u.ringWidth=0,u.ringPad=0,u.outline=!1,o){var h=o.r,c=o.g,l=o.b,d=o.opacity;u.setOuterColor({r:h,g:c,b:l,opacity:d})}return void 0===s&&(s=0),u.innerRadius=s,r&&u.setInnerColor(r),u}return i(e,t),e.prototype.setOuterColor=function(t){var e=t.r,n=t.g,i=t.b,o=t.opacity;this.r=e,this.g=n,this.b=i,this.a=o},e.prototype.setInnerColor=function(t){this.r2=t.r,this.g2=t.g,this.b2=t.b,this.a2=t.opacity},e.prototype.clone=function(t){return Object.assign(new e(this._centerX,this._centerY,this._radius,o.rgb(this.r,this.g,this.b,this.a),o.rgb(this.r2,this.g2,this.b2,this.a2),this.innerRadius,this.d),this,t)},e.prototype.cloneWithData=function(t){return Object.assign(new e(this._centerX,this._centerY,this._radius,o.rgb(this.r,this.g,this.b,this.a),o.rgb(this.r2,this.g2,this.b2,this.a2),this.innerRadius),this,t)},e}(r.Circle);e.CircleShape=s},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(15),r=n(5),s=n(9),a=function(t){function e(e){var n=t.call(this,e)||this;return n.depth=0,n.lineWidth=1,n.encapsulatePoints(n.getTriangleStrip()),n.cachesQuadSegments=e.cacheSegments,n.depth=e.depth||0,n.lineWidth=e.lineWidth||1,n.startColor=e.startColor,n.endColor=e.endColor,n}return i(e,t),e.prototype.clone=function(){var t=new e({cacheSegments:this.cachesSegments,controlPoints:this.controlPoints,end:this.p2,endColor:this.endColor,lineWidth:this.lineWidth,resolution:this.resolution,start:this.p1,startColor:this.startColor,type:this.type});return t.d=this.d,t},e.prototype.distanceTo=function(e){return Math.max(0,t.prototype.distanceTo.call(this,e)-this.lineWidth/2)},e.prototype.getTriangleStrip=function(){if(this.cachesSegments&&this.cachedQuadSegments)return this.cachedQuadSegments;var t=[],e=[],n=this.getLineStrip(),i=this.lineWidth/2,o=new r.Line(s.Point.zero(),s.Point.zero()),a=s.Point.zero();if(n.length<2)return[];for(var u=0;u<n.length-1;u++){if(o.setPoints(n[u],n[u+1]),0===e.length)e.push(o.perpendicular);else{var h={x:e[u].x+o.perpendicular.x,y:e[u].y+o.perpendicular.y},c=Math.sqrt(h.x*h.x+h.y*h.y);h.x=h.x/c,h.y=h.y/c,e[u]=h}e.push(o.perpendicular)}for(var u=0;u<n.length-1;u++){var l=n[u],d=n[u+1];t.push(s.Point.add(s.Point.scale(e[u+1],-i,a),d)),t.push(s.Point.add(s.Point.scale(e[u+1],i,a),d)),t.push(s.Point.add(s.Point.scale(e[u],-i,a),l)),t.push(s.Point.add(s.Point.scale(e[u],i,a),l))}return t},e.prototype.setPoints=function(e,n,i){t.prototype.setPoints.call(this,e,n,i),this.cachedQuadSegments=[]},e}(o.CurvedLine);e.CurvedLineShape=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(7),r=n(5),s=n(17),a=function(t){function e(e,n,i,o,r,s,a){var u=t.call(this,e,n,i,o.r,o.g,o.b,o.opacity,r.r,r.g,r.b,r.opacity,s)||this;return u.tl={x:0,y:0},u.bl={x:0,y:0},u.tr={x:0,y:0},u.br={x:0,y:0},u.endWidth=1,u.endWidth=a,u.setPoints(e,n),u}return i(e,t),e.prototype.clone=function(t){return Object.assign(new e(this.p1,this.p2,this.d,o.rgb(this.r,this.g,this.b,this.a),o.rgb(this.r2,this.g2,this.b2,this.a2),this.thickness,this.endWidth),this,t)},e.prototype.pointInside=function(t){for(var e=t.x,n=t.y,i=[this.tl,this.tr,this.br,this.bl],o=i.length,r=!1,s=0,a=o-1;s<o;a=s++)i[s].y>n!=i[a].y>n&&e<(i[a].x-i[s].x)*(n-i[s].y)/(i[a].y-i[s].y)+i[s].x&&(r=!r);return r},e.prototype.setPoints=function(e,n){if(t.prototype.setPoints.call(this,e,n),this.tl){var i=this.thickness/2,o=this.endWidth/2,s=this.perpendicular.x*i,a=this.perpendicular.y*i,u=this.perpendicular.x*o,h=this.perpendicular.y*o;this.tl.x=this.p1.x+s,this.tl.y=this.p1.y+a,this.bl.x=this.p1.x-s,this.bl.y=this.p1.y-a,this.tr.x=this.p2.x+u,this.tr.y=this.p2.y+h,this.br.x=this.p2.x-u,this.br.y=this.p2.y-h,this.topEdge=new r.Line(this.tl,this.tr),this.bottomEdge=new r.Line(this.bl,this.br),this.encapsulatePoints([this.tl,this.tr,this.bl,this.br])}},e}(s.LineShape);e.EdgeShape=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=function(t){function e(e,n){var i=t.call(this,0,0,n,n)||this;return i.opacity=1,i.texture=e,i.size=n,i}return i(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return Math.max(this.width,this.height)},set:function(t){this.texture.aspectRatio>1?(this.width=t,this.height=t/this.texture.aspectRatio):(this.width=t*this.texture.aspectRatio,this.height=t)},enumerable:!0,configurable:!0}),e.prototype.centerOn=function(t,e){this.x=t-this.width/2,this.y=e-this.height/2},e}(o.Bounds);e.ImageShape=r},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),r=n(18),s=n(19),a=new s.Sprite(200,200,1,1),u=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,{x:0,y:1},{width:1,height:1},0,r.AnchorPosition.TopLeft)||this;return n.depth=0,n.direction="inherit",n.font="serif",n.fontSize=10,n.fontWeight=400,n.maxWidth=void 0,n.text="",n.id="",n.textAlign="start",n.textBaseline="alphabetic",n.zoomable=!1,n.rasterizationOffset={x:0,y:12},n.rasterizationPadding={width:0,height:0},n.r=1,n.g=1,n.b=1,n.a=1,Object.assign(n,e),n.setFontSize(e.fontSize),n}return i(e,t),Object.defineProperty(e.prototype,"baseLabel",{get:function(){return this._baseLabel},set:function(t){this._baseLabel=t,this.text=t.text,this.fontSize=t.fontSize,this.font=t.font,this.textAlign=t.textAlign,this.textBaseline=t.textBaseline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rasterizedLabel",{get:function(){return this.baseLabel?this.baseLabel.rasterizedLabel:this._rasterizedLabel},set:function(t){this._rasterizedLabel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{set:function(t){this.r=t.r,this.g=t.g,this.b=t.b},enumerable:!0,configurable:!0}),e.prototype.copyLabel=function(t){Object.assign(this,o.omit(["x","y","width","height"],t)),this.setText(t.text)},e.prototype.getText=function(){return this._baseLabel?this._baseLabel.getText():this.text},e.prototype.makeCSSFont=function(t){return this.fontWeight+" "+(t||this.fontSize)+"px "+this.font},e.prototype.position=function(t,e){this.x=t,this.y=e},e.prototype.setFontSize=function(t){var e=this.getText(),n=1,i=1;if(this._baseLabel){var o=t/this.baseLabel.fontSize;i=this.baseLabel.height*o,n=this.baseLabel.width*o,console.log("with base",t,i,this.baseLabel.height,o,t,this.baseLabel.fontSize)}else{a.context.font=this.makeCSSFont();var r=a.context.measureText(e);i=t+this.rasterizationPadding.height,n=r.width+this.rasterizationPadding.width,console.log("no base",t,i,n)}this.fontSize=t,this.setSize({width:n,height:i}),this.update()},e.prototype.setText=function(t){this.text=t,this.setFontSize(this.fontSize)},e}(r.RotateableQuad);e.Label=u},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=function(t){function e(e,n){var i=t.call(this,e.x,e.right,e.y,e.bottom)||this;return i.r=1,i.g=0,i.b=0,i.a=1,i}return i(e,t),e}(o.Bounds);e.QuadShape=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=function(){function t(t,e,n,o){void 0===o&&(o=1),this.opacity=1,this.pixelWidth=2,this.pixelHeight=2,t instanceof i.Color?(this.color=t.clone(),this.opacity=void 0===e?1:e):(this.color=new i.Color(t,e,n),this.opacity=o)}return t}();e.AtlasColor=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(0)),i(n(14)),i(n(15)),i(n(5)),i(n(9)),i(n(18))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(4)),i(n(43)),i(n(44)),i(n(11)),i(n(13)),i(n(45)),i(n(16)),i(n(12))},function(t,e,n){"use strict";function i(t){return Array.from(t).filter(function(t){return t[1]}).map(function(t){return t[0]})}Object.defineProperty(e,"__esModule",{value:!0}),e.boolMapToArray=i;var o=function(){function t(){this.cachedSelection=new Map,this.selections=new Map,this._didSelectionChange=new Map}return t.prototype.clearAllSelections=function(){for(var t=0,e=Array.from(this.selections.keys());t<e.length;t++){var n=e[t];this.clearSelection(n)}},t.prototype.clearSelection=function(t){this.getSelection(t).length&&(this.selections.set(t,null),this.cachedSelection.set(t,null),this._didSelectionChange.set(t,!0))},t.prototype.deselect=function(t,e){var n=this.selections.get(t);n&&n.get(e)&&(this.cachedSelection.set(t,null),n.set(e,!1),this._didSelectionChange.set(t,!0))},t.prototype.didSelectionCategoryChange=function(t){return this._didSelectionChange.get(t)},t.prototype.didSelectionChange=function(){return i(this._didSelectionChange).length>0},t.prototype.finalizeUpdate=function(){for(var t=0,e=Array.from(this._didSelectionChange.keys());t<e.length;t++){var n=e[t];this._didSelectionChange.set(n,!1)}},t.prototype.getSelection=function(t){if(!this.cachedSelection.get(t)){var e=this.selections.get(t);e?this.cachedSelection.set(t,i(e)):this.cachedSelection.set(t,[])}return this.cachedSelection.get(t)},t.prototype.select=function(t,e){var n=this.selections.get(t);n||(n=new Map,this.selections.set(t,n)),n.get(e)||(this.cachedSelection.set(t,null),n.set(e,!0),this._didSelectionChange.set(t,!0))},t.prototype.toggleSelect=function(t,e){var n=this.selections.get(t);n||(n=new Map,this.selections.set(t,n)),this.cachedSelection.set(t,null),n.get(e)?this.deselect(t,e):this.select(t,e),this._didSelectionChange.set(t,!0)},t}();e.CustomSelection=o},function(t,e,n){"use strict";function i(t){var e=t.ctx,n=t.text,i=t.bboxHeight,o=t.ctx.canvas.height,r=t.baseline||"alphabetic",s=t.flip||!1,a=t.drawBaseline||!1,u="Arial, san-serif",h=14;t.fontFamily&&(u=t.fontFamily),t.fontSize&&(h=t.fontSize),e.save(),e.font=h+"px "+u;var c=e.measureText(n).width,l=2*h,d=2*h,f=e.canvas.width=Math.round(c+2*l),p=e.canvas.height=o||Math.round(2*d);"string"==typeof r&&(d=0,e.textBaseline=r),s&&e.scale(1,-1),e.font=h+"px "+u,e.fillText(n,l,"number"==typeof i?i:d),a&&e.fillRect(0,o/2,e.canvas.width,1);for(var y=e.getImageData(0,0,f,p),g=y.data,m=g.length,b=0,v=0,x=0,w=0;m>0;){g[m+3]&&(m-=m%(4*f),g[m+3]&&(m-=m%(4*f),b=m/4/f,b-=d-h,m=0),m-=4),x=0;for(var _=0,M=0;M<p&&_<f;){g[M*f*4+4*_+3]&&(x=_-l,M=p,_=f),M++,M%p==0&&(M=0,_++)}for(w=0,_=f,M=0;M<p&&_>0;)g[M*f*4+4*_+3]&&(w=_-l,M=p,_=f),++M%p==0&&(M=0,_--);for(v=0,m=g.length;m>0;)g[m+3]&&(m-=m%(4*f),v=m/4/f,m=0),m-=4;e.restore()}return{bottom:v,height:b-0,left:-x,top:h-0,width:w-x}}Object.defineProperty(e,"__esModule",{value:!0}),e.getFontMetrics=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.buffer=[],this.bustCache=!0}return t.prototype.generate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bustCache&&(this.buildCache.apply(this,t),this.bustCache=!1)},t.prototype.buildCache=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.getBuffer=function(){return this.buffer},t}();e.ShapeBufferCache=i}])});